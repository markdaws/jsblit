var MathHelper={};MathHelper.zeroTolerance=1.0E-6;MathHelper.PI=3.141592653589793;MathHelper.sin=function(a){return Math.sin(a)};MathHelper.asin=function(a){return Math.asin(a)};MathHelper.cos=function(a){return Math.cos(a)};MathHelper.acos=function(a){return Math.acos(a)};MathHelper.tan=function(a){return Math.tan(a)};MathHelper.atan=function(a){return Math.atan(a)};MathHelper.atan2=function(a,c){return Math.atan2(a,c)};MathHelper.sqrt=function(a){return Math.sqrt(a)};
MathHelper.invSqrt=function(a){return 1/Math.sqrt(a)};MathHelper.abs=function(a){return Math.abs(a)};MathHelper.isFinite=function(a){return a>Number.NEGATIVE_INFINITY&&a<Number.POSITIVE_INFINITY};MathHelper.clamp=function(a,c,b){return Math.min(Math.max(a,c),b)};function Vector2(a,c){this.x=a;this.y=c}
Vector2.prototype={dot:function(a){return this.x*a.x+this.y*a.y},perp:function(){return new Vector2(this.y,-this.x)},normalize:function(){var a;a=this.length();if(a<MathHelper.zeroTolerance)return new Vector2(0,0);a=1/a;return new Vector2(this.x*a,this.y*a)},length:function(){return MathHelper.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},add:function(a){return new Vector2(this.x+a.x,this.y+a.y)},subtract:function(a){return new Vector2(this.x-a.x,
this.y-a.y)},multiplyScalar:function(a){return new Vector2(this.x*a,this.y*a)},equals:function(a){return this.x===a.x&&this.y===a.y},toString:function(){return"["+this.x+", "+this.y+"]"}};function Vector3(a,c,b){this.x=a;this.y=c;this.z=b}
Vector3.prototype={dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},normalize:function(){var a;a=this.length();if(a<MathHelper.zeroTolerance)return new Vector3(0,0,0);a=1/a;return new Vector3(this.x*a,this.y*a,this.z*a)},cross:function(a){return new Vector3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},length:function(){return MathHelper.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},add:function(a){return new Vector3(this.x+
a.x,this.y+a.y,this.z+a.z)},subtract:function(a){return new Vector3(this.x-a.x,this.y-a.y,this.z-a.z)},multiplyScalar:function(a){return new Vector3(this.x*a,this.y*a,this.z*a)},equals:function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z},toString:function(){return"["+this.x+", "+this.y+", "+this.z+"]"}};function Vector4(a,c,b,d){this.x=a;this.y=c;this.z=b;this.w=d}
Vector4.prototype={dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},normalize:function(){var a;a=this.length();if(a<MathHelper.zeroTolerance)return new Vector4(0,0,0,0);a=1/a;return new Vector4(this.x*a,this.y*a,this.z*a,this.w*a)},length:function(){return MathHelper.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},add:function(a){return new Vector4(this.x+a.x,this.y+a.y,this.z+
a.z,this.w+a.w)},subtract:function(a){return new Vector4(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)},multiplyScalar:function(a){return new Vector4(this.x*a,this.y*a,this.z*a,this.w*a)},equals:function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},toString:function(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}};function Matrix4x4(a,c,b,d,e,g,h,i,j,m,k,l,f,n,o,p){this.m11=a;this.m12=c;this.m13=b;this.m14=d;this.m21=e;this.m22=g;this.m23=h;this.m24=i;this.m31=j;this.m32=m;this.m33=k;this.m34=l;this.m41=f;this.m42=n;this.m43=o;this.m44=p}Matrix4x4.createIdentity=function(){return new Matrix4x4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};Matrix4x4.createScale=function(a,c,b){return new Matrix4x4(a,0,0,0,0,c,0,0,0,0,b,0,0,0,0,1)};
Matrix4x4.createTranslation=function(a,c,b){return new Matrix4x4(1,0,0,a,0,1,0,c,0,0,1,b,0,0,0,1)};Matrix4x4.createRotationX=function(a){return new Matrix4x4(1,0,0,0,0,MathHelper.cos(a),-MathHelper.sin(a),0,0,MathHelper.sin(a),MathHelper.cos(a),0,0,0,0,1)};Matrix4x4.createRotationY=function(a){return new Matrix4x4(MathHelper.cos(a),0,-MathHelper.sin(a),0,0,1,0,0,MathHelper.sin(a),0,MathHelper.cos(a),0,0,0,0,1)};
Matrix4x4.createRotationZ=function(a){return new Matrix4x4(MathHelper.cos(a),-MathHelper.sin(a),0,0,MathHelper.sin(a),MathHelper.cos(a),0,0,0,0,1,0,0,0,0,1)};
Matrix4x4.prototype={add:function(a){return new Matrix4x4(this.m11+a.m11,this.m12+a.m12,this.m13+a.m13,this.m14+a.m14,this.m21+a.m21,this.m22+a.m22,this.m23+a.m23,this.m24+a.m24,this.m31+a.m31,this.m32+a.m32,this.m33+a.m33,this.m34+a.m34,this.m41+a.m41,this.m42+a.m42,this.m43+a.m43,this.m44+a.m44)},subtract:function(a){return new Matrix4x4(this.m11-a.m11,this.m12-a.m12,this.m13-a.m13,this.m14-a.m14,this.m21-a.m21,this.m22-a.m22,this.m23-a.m23,this.m24-a.m24,this.m31-a.m31,this.m32-a.m32,this.m33-
a.m33,this.m34-a.m34,this.m41-a.m41,this.m42-a.m42,this.m43-a.m43,this.m44-a.m44)},multiply:function(a){return new Matrix4x4(this.m11*a.m11+this.m12*a.m21+this.m13*a.m31+this.m14*a.m41,this.m11*a.m12+this.m12*a.m22+this.m13*a.m32+this.m14*a.m42,this.m11*a.m13+this.m12*a.m23+this.m13*a.m33+this.m14*a.m43,this.m11*a.m14+this.m12*a.m24+this.m13*a.m34+this.m14*a.m44,this.m21*a.m11+this.m22*a.m21+this.m23*a.m31+this.m24*a.m41,this.m21*a.m12+this.m22*a.m22+this.m23*a.m32+this.m24*a.m42,this.m21*a.m13+this.m22*
a.m23+this.m23*a.m33+this.m24*a.m43,this.m21*a.m14+this.m22*a.m24+this.m23*a.m34+this.m24*a.m44,this.m31*a.m11+this.m32*a.m21+this.m33*a.m31+this.m34*a.m41,this.m31*a.m12+this.m32*a.m22+this.m33*a.m32+this.m34*a.m42,this.m31*a.m13+this.m32*a.m23+this.m33*a.m33+this.m34*a.m43,this.m31*a.m14+this.m32*a.m24+this.m33*a.m34+this.m34*a.m44,this.m41*a.m11+this.m42*a.m21+this.m43*a.m31+this.m44*a.m41,this.m41*a.m12+this.m42*a.m22+this.m43*a.m32+this.m44*a.m42,this.m41*a.m13+this.m42*a.m23+this.m43*a.m33+
this.m44*a.m43,this.m41*a.m14+this.m42*a.m24+this.m43*a.m34+this.m44*a.m44)},multiplyScalar:function(a){return new Matrix4x4(this.m11*a,this.m12*a,this.m13*a,this.m14*a,this.m21*a,this.m22*a,this.m23*a,this.m24*a,this.m31*a,this.m32*a,this.m33*a,this.m34*a,this.m41*a,this.m42*a,this.m43*a,this.m44*a)},transpose:function(){return new Matrix4x4(this.m11,this.m21,this.m31,this.m41,this.m12,this.m22,this.m32,this.m42,this.m13,this.m23,this.m33,this.m43,this.m14,this.m24,this.m34,this.m44)},transformVector4:function(a){return new Vector4(this.m11*
a.x+this.m12*a.y+this.m13*a.z+this.m14*a.w,this.m21*a.x+this.m22*a.y+this.m23*a.z+this.m24*a.w,this.m31*a.x+this.m32*a.y+this.m33*a.z+this.m34*a.w,this.m41*a.x+this.m42*a.y+this.m43*a.z+this.m44*a.w)},transformVector3:function(a){return new Vector3(this.m11*a.x+this.m12*a.y+this.m13*a.z,this.m21*a.x+this.m22*a.y+this.m23*a.z,this.m31*a.x+this.m32*a.y+this.m33*a.z)},determinant:function(){return(this.m11*this.m22-this.m12*this.m21)*(this.m33*this.m44-this.m34*this.m43)-(this.m11*this.m23-this.m13*
this.m21)*(this.m32*this.m44-this.m34*this.m42)+(this.m11*this.m24-this.m14*this.m21)*(this.m32*this.m43-this.m33*this.m42)+(this.m12*this.m23-this.m13*this.m22)*(this.m31*this.m44-this.m34*this.m41)-(this.m12*this.m24-this.m14*this.m22)*(this.m31*this.m43-this.m33*this.m41)+(this.m13*this.m24-this.m14*this.m23)*(this.m31*this.m42-this.m32*this.m41)},inverse:function(){var a,c,b,d,e,g,h,i,j,m,k,l,f,n,o,p,q,r,s,t;a=this.m11*this.m22-this.m12*this.m21;c=this.m11*this.m23-this.m13*this.m21;b=this.m11*
this.m24-this.m14*this.m21;d=this.m12*this.m23-this.m13*this.m22;e=this.m12*this.m24-this.m14*this.m22;g=this.m13*this.m24-this.m14*this.m23;h=this.m31*this.m42-this.m32*this.m41;i=this.m31*this.m43-this.m33*this.m41;j=this.m31*this.m44-this.m34*this.m41;m=this.m32*this.m43-this.m33*this.m42;k=this.m32*this.m44-this.m34*this.m42;l=this.m33*this.m44-this.m34*this.m43;f=a*l-c*k+b*m+d*j-e*i+g*h;if(MathHelper.abs(f)<MathHelper.zeroTolerance)return Matrix4x4.createIdentity();n=this.m22*l-this.m23*k+this.m24*
m;o=-this.m12*l+this.m13*k-this.m14*m;p=this.m42*g-this.m43*e+this.m44*d;q=-this.m32*g+this.m33*e-this.m34*d;r=-this.m21*l+this.m23*j-this.m24*i;l=this.m11*l-this.m13*j+this.m14*i;s=-this.m41*g+this.m43*b-this.m44*c;g=this.m31*g-this.m33*b+this.m34*c;t=this.m21*k-this.m22*j+this.m24*h;j=-this.m11*k+this.m12*j-this.m14*h;k=this.m41*e-this.m42*b+this.m44*a;b=-this.m31*e+this.m32*b-this.m34*a;e=-this.m21*m+this.m22*i-this.m23*h;h=this.m11*m-this.m12*i+this.m13*h;i=-this.m41*d+this.m42*c-this.m43*a;a=
this.m31*d-this.m32*c+this.m33*a;f=1/f;return new Matrix4x4(n*f,o*f,p*f,q*f,r*f,l*f,s*f,g*f,t*f,j*f,k*f,b*f,e*f,h*f,i*f,a*f)},toString:function(){return this.m11+", "+this.m12+", "+this.m13+", "+this.m14+"\n"+this.m21+", "+this.m22+", "+this.m23+", "+this.m24+"\n"+this.m31+", "+this.m32+", "+this.m33+", "+this.m34+"\n"+this.m41+", "+this.m42+", "+this.m43+", "+this.m44+"\n"}};function Quaternion(a,c,b,d){this.w=a;this.x=c;this.y=b;this.z=d}Quaternion.createIdentity=function(){return new Quaternion(1,0,0,0)};
Quaternion.fromRotationMatrix=function(a){var c,b;b=new Quaternion(0,0,0,0);c=a.m11+a.m22+a.m33;if(MathHelper.abs(c)>MathHelper.zeroTolerance){b.w=MathHelper.sqrt(c+1)*0.5;c=1/(4*b.w);b.x=(a.m32-a.m23)*c;b.y=(a.m13-a.m31)*c;b.z=(a.m21-a.m12)*c}else{c=0;if(a.m22>a.m11){c=1;if(a.m33>a.m22)c=2}else if(a.m33>a.m11)c=2;switch(c){case 0:b.x=0.5*MathHelper.sqrt(a.m11-a.m22-a.m33+1);c=1/(4*b.x);b.w=(a.m32-a.m23)*c;b.y=(a.m12+a.m21)*c;b.z=(a.m13+a.m31)*c;break;case 1:b.y=0.5*MathHelper.sqrt(a.m22-a.m11-a.m33+
1);c=1/(4*b.y);b.w=(a.m13-a.m31)*c;b.x=(a.m12+a.m21)*c;b.z=(a.m23+a.m32)*c;break;case 2:b.z=0.5*MathHelper.sqrt(a.m33-a.m11-a.m22+1);c=1/(4*b.z);b.w=(a.m21-a.m12)*c;b.x=(a.m13+a.m31)*c;b.y=(a.m32+a.m23)*c;break}}return b};Quaternion.fromAxisAngle=function(a,c){var b,d;b=0.5*c;d=MathHelper.sin(b);return new Quaternion(MathHelper.cos(b),a.x*d,a.y*d,a.z*d)};
Quaternion.slerp=function(a,c,b){var d,e,g;if(a===0)return c;if(a===1)return b;d=c.dot(b);d=MathHelper.acos(d);if(MathHelper.abs(d)>=MathHelper.zeroTolerance){e=MathHelper.sin(d);g=1/e;e=MathHelper.sin((1-a)*d)*g;a=MathHelper.sin(a*d)*g;return c.multiplyScalar(e).add(b.multiplyScalar(a))}return c};
Quaternion.prototype={dot:function(a){return this.w*a.w+this.x*a.x+this.y*a.y+this.z*a.z},length:function(){return MathHelper.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var a;a=this.length();if(a<MathHelper.zeroTolerance)return new Quaternion(0,0,0,0);a=1/a;return new Quaternion(this.w*a,this.x*a,this.y*a,this.z*a)},inverse:function(){var a;a=this.w*this.w+this.x*this.x+this.y*this.y*this.z*this.z;if(MathHelper.abs(a)>MathHelper.zeroTolerance){a=1/a;return new Quaternion(this.w*
a,-this.x*a,-this.y*a,-this.z*a)}return new Quaternion(0,0,0,0)},conjugate:function(){return new Quaternion(this.w,-this.x,-this.y,-this.z)},transform:function(a){var c,b,d;b=2*(this.x*a.x+this.y*a.y+this.z*a.z);d=2*this.w;c=d*this.w-1;return new Vector3(c*a.x+b*this.x+d*(this.y*a.z-this.z*a.y),c*a.y+b*this.y+d*(this.z*a.x-this.x*a.z),c*a.z+b*this.z+d*(this.x*a.y-this.y*a.x))},add:function(a){return new Quaternion(this.w+a.w,this.x+a.x,this.y+a.y,this.z+a.z)},multiply:function(a){return new Quaternion(this.w*
a.w-this.x*a.x-this.y*a.y-this.z*a.z,this.y*a.z-this.z*a.y+this.w*a.x+a.w*this.x,this.z*a.x-this.x*a.z+this.w*a.y+a.w*this.y,this.x*a.y-this.y*a.x+this.w*a.z+a.w*this.z)},multiplyScalar:function(a){return new Quaternion(this.w*a,this.x*a,this.y*a,this.z*a)},toRotationMatrix:function(){var a,c,b,d,e,g,h,i,j;a=2*this.x;c=2*this.y;b=2*this.z;d=a*this.w;e=c*this.w;g=b*this.w;a=a*this.x;h=c*this.x;i=b*this.x;c=c*this.y;j=b*this.y;b=b*this.z;return new Matrix4x4(1-(c+b),h-g,i+e,0,h+g,1-(a+b),j-d,0,i-e,
j+d,1-(a+c),0,0,0,0,1)},toAxisAngle:function(){var a;a=this.x*this.x+this.y*this.y+this.z*this.z;if(a>MathHelper.zeroTolerance){a=MathHelper.invSqrt(a);return new Vector4(this.x*a,this.y*a,this.z*a,2*MathHelper.acos(this.w))}return new Vector4(1,0,0,0)},toString:function(){return"["+this.w+", "+this.x+", "+this.y+", "+this.z+"]"}};var GraphicsHelper={};GraphicsHelper.createLookAtRH=function(a,c,b){var d,e;c=c.normalize();b=b.normalize();e=b.subtract(c.multiplyScalar(b.dot(c))).normalize();d=c.cross(e);b=Matrix4x4.createIdentity();b.m11=d.x;b.m12=d.y;b.m13=d.z;b.m21=e.x;b.m22=e.y;b.m23=e.z;b.m31=-c.x;b.m32=-c.y;b.m33=-c.z;a=b.transformVector3(a);b.m14=-a.x;b.m24=-a.y;b.m34=-a.z;return b};
GraphicsHelper.createPerspective=function(a,c,b,d){a=1/MathHelper.tan(a/2);return new Matrix4x4(a/c,0,0,0,0,a,0,0,0,0,(b+d)/(b-d),2*b*d/(b-d),0,0,-1,0)};function Frame(){this.Position=new Vector3(0,0,0);this.Rotation=Quaternion.createIdentity()};function PerspectiveCamera(){this.viewport=null;this.position=new Vector3(0,0,0);this.up=new Vector3(0,1,0);this.look=new Vector3(0,0,-1);this.fieldOfView=MathHelper.PI/2;this.viewTransform=Matrix4x4.createIdentity();this.projectionTransform=Matrix4x4.createIdentity();this.isDirty=true}
PerspectiveCamera.prototype={setDirty:function(){this.isDirty=true},setViewport:function(a){this.viewport=a;this.setDirty()},getViewport:function(){return this.viewport},setPosition:function(a){this.position=a;this.setDirty()},getPosition:function(){return this.position},setVerticalFov:function(a){this.fieldOfView=a;this.setDirty()},getVerticalFov:function(){return this.fieldOfView},setLook:function(a){this.look=a;this.setDirty()},getLook:function(){return this.look},setUp:function(a){this.up=a;this.setDirty()},
getUp:function(){return this.up},getViewTransform:function(){this.isDirty&&this.updateTransforms();return this.viewTransform},getProjectionTransform:function(){this.isDirty&&this.updateTransforms();return this.projectionTransform},updateTransforms:function(){this.viewTransform=GraphicsHelper.createLookAtRH(this.position,this.look,this.up);this.isDirty=false}};function Viewport(a,c,b,d){this.width=a;this.height=c;this.aspectRatio=this.width/this.height;this.nearDistance=b;this.farDistance=d}Viewport.prototype={getWidth:function(){return this.width},getHeight:function(){return this.height},getAspectRatio:function(){return this.aspectRatio},getNearDistance:function(){return this.nearDistance},getFarDistance:function(){return this.farDistance}};
